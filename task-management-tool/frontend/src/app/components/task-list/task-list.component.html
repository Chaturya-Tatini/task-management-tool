<div class="task-form" *ngIf="showForm">
  <form #taskForm="ngForm" (ngSubmit)="saveTask()">
    <input [(ngModel)]="newTask.title" name="title" placeholder="Task Title" required minlength="3" #title="ngModel">
    <div *ngIf="title.invalid && title.touched" class="error">Title is required (min 3 characters)</div>
    
    <textarea [(ngModel)]="newTask.description" name="description" placeholder="Task Description" required #desc="ngModel"></textarea>
    <div *ngIf="desc.invalid && desc.touched" class="error">Description is required</div>
    
    <select [(ngModel)]="newTask.status" name="status" required>
      <option value="pending">Pending</option>
      <option value="in-progress">In Progress</option>
      <option value="completed">Completed</option>
    </select>
    
    <button type="submit" [disabled]="taskForm.invalid">Save</button>
    <button type="button" (click)="cancelEdit()">Cancel</button>
  </form>
</div>

<ul>
  <li *ngFor="let task of filteredTasks" class="task-item">
    <div *ngIf="editingId !== task.id">
      <h3>{{ task.title }}</h3>
      <p>{{ task.description }}</p>
      <span>Status: {{ task.status }}</span>
      <br>
      <button (click)="editTask(task)">Edit</button>
      <button (click)="markCompleted(task)" *ngIf="task.status !== 'completed'" style="background: green; color: white; margin: 5px;">✓ Mark Complete</button>
      <span *ngIf="task.status === 'completed'" style="background: gray; color: white; padding: 8px; margin: 5px; border-radius: 4px;">✓ Completed</span>
      <button (click)="deleteTask(task.id)" style="background: red; color: white;">Delete</button>
    </div>
    <div *ngIf="editingId === task.id" class="edit-form">
      <input [(ngModel)]="editingTask.title" placeholder="Task Title">
      <textarea [(ngModel)]="editingTask.description" placeholder="Description"></textarea>
      <select [(ngModel)]="editingTask.status">
        <option value="pending">Pending</option>
        <option value="in-progress">In Progress</option>
        <option value="completed">Completed</option>
      </select>
      <button (click)="updateTask()">Update</button>
      <button (click)="cancelEdit()">Cancel</button>
    </div>
  </li>
</ul>

<div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
<div *ngIf="successMessage" class="success-message">{{ successMessage }}</div>

<div class="filters">
  <label>Filter by Status:</label>
  <select [(ngModel)]="filterStatus" (change)="filterTasks()">
    <option value="all">All Tasks</option>
    <option value="pending">Pending</option>
    <option value="in-progress">In Progress</option>
    <option value="completed">Completed</option>
  </select>
</div>

<button (click)="showAddForm()" *ngIf="!showForm">Add New Task</button>